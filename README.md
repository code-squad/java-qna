# STEP 01.

## 헤로쿠 링크

[first-qna heroku](https://first-qna.herokuapp.com/)

## 요구사항

- 회원 가입 기능 구현
- 회원 목록 보기 구현
- 회원 프로필 보기 구현
- 질문하기 구현
- 질문 목록 보기 구현
- 회원정보 수정 구현(선택사항)

## 회원 가입 기능

### 구현한 것

[✓]  폼에 입력 받은 회원 정보를 받아와 User클래스의 인스턴스를 생성한다.

[✓]  생성한 인스턴스를 유저 리스트(ArrayList)에 저장한다.

[✓]  저장을 완료한 후 사용자 목록 페이지 (/users)로 redirect 한다.

### 미해결

[X]  아이디, 이름, 이메일, 비밀번호가 각각의 길이와 양식에 맞게 전달 되지 않았을 경우 예외 처리 필요

## 회원 목록 보기

### 구현한 것

[✓]  Model을 메소드의 인자로 받은 후 Model에 사용자 목록을 users라는 이름으로 전달한다.

[✓]  user/list.html 에서 사용자 목록을 출력한다.

### 미해결

[X]  user 인스턴스의 id 값의 자료형은 long형이 맞는 듯 한데,  처리하는 과정에서 int로의 형변환이 필요했다. 무언가 좀 아닌 듯(?) 데이터베이스를 사용 해봐야 할거 같다.

[X]  또한 id 값은 한번 할당되면 불변해야 하는 상수 값이 되어야 할 듯 한데, setter를 사용해서 할당 하였다. 더 고민 해봐야겠다.

## 회원 프로필 보기

### 구현한 것

[✓]  사용자 목록에서 이름을 클릭하면 해당 프로필 페이지로 이동 한다.

[✓]  프로필 페이지에서 해당 사용자의 이름, 이메일 주소가 출력 된다.

[✓]  URL은 "/users/{userId}"와 같이 매핑한다.

### 미해결

[X]  회원 가입 → 확인 → 코드 수정 → 회원 가입 → 확인 → ... 테스트 방법에 대한 학습 필요

## 질문하기

### 구현한 것

[✓]  사용자가 전달한 값을 Question 클래스를 생성해 저장한다.

[✓]  질문 목록을 관리하는 ArrayList를 생성한 후 앞에서 생성한 Question 인스턴스를 ArrayList에 저장한다.

[✓]  질문 추가를 완료한 후 메인 페이지(“redirect:/”)로 이동한다.

### 미해결

[X]  미입력 폼이 전달 되었을 때의 예외처리

[X]  아이디는 수정될 수 없도록 처리

## 질문 목록 보기

### 구현한 것

[✓]  조회한 질문 목록을(ArrayList) Model에 저장한 후 View에 전달한다.

[✓]  View에서 Model을 통해 전달한 질문 목록을 출력한다.

[✓]  질문 목록의 제목을 클릭 했을 때 질문 상세 페이지에 접속할 수 있다.

[✓]  질문 상세 페이지 접근 URL은 "/questions/{index}" 로 구현한다.

[✓]  질문 객체에 id 인스턴스 변수를 추가하고 ArrayList에 질문 객체를 추가할 때 ArrayList.size() + 1을 질문 객체의 id로 사용한다.

[✓]  Controller에 상세 페이지 접근 method를 추가하고 URL은 /questions/{index}로 매핑한다.

[✓]  ArrayList에서 index - 1 해당하는 데이터를 조회한 후 Model에 저장해 View에 전달한다.

### 미해결

[X]  Question의 id 값 또한 한번 할당되면 고정되어야 할 값인 듯 하다. 상수로 할당 할 방법을 잘 모르겠는데 DB를 연동한 뒤 해결 해봐야겠다.

# STEP 02.

## 피드백 반영 사항

- 날짜 처리는 LocalDateTime 사용
- Id 값은 Long을 사용 : null 값을 담을 수 있기 때문.
- printUsers → listUsers 메서드 이름 개선

## 요구사항

- 사용자 데이터를 DB에 저장하기
- 회원 정보 수정하기
- 질문 데이터를 DB에 저장하기

## 사용자 데이터를 DB에 저장하기

### 해결한 것

[✓]  H2 데이터베이스에 대한 의존관계 설정 및 설정 : maven repository에서 h2의 따끈한 최신 버전인 "1.4.200" 버전을 의존성에 추가 하였다. 그러나 계속 빌드 오류가 나서 (Connection 에러, ddl-auto 속성 설정 오류) 6시간 동안 해결 방법을 찾다가 시간을 허비했다. 앞으로 무엇이던 최신버전은 '절대' 안 쓸 생각이다.

[✓]  폼에서 입력 받은 User 정보 데이터베이스에 저장

[✓]  id 값으로 User 조회

### 미해결점 및 개선해야 할 사항

[X]  findOne, findById 차이점 이해

[X]  null일 경우 .orElseThrow로 예외 처리를 하는 것이 맞는 방법일까?

[X]  예외 처리 구현에 대해 학습하고 고민 해보기

[X]  사용자 정보 수정시 기존 비밀번호와 일치 할 경우에만 회원의 정보를 수정, 비밀번호 자체 변경 기능 미구현. (둘을 동시에 처리 할 방법을 모르겠다.)

## 질문 데이터를 DB에 저장하기

### 해결한 것

[✓]  질문글을 DB에 저장

[✓]  DB에서 데이터를 꺼내와 게시글 목록 출력

[✓]  질문 상세보기 기능 구현

### 미해결점 및 개선해야 할 사항

[X]  게시글은 어떠한 예외 처리가 필요할까?

# STEP 03.

## 피드백 반영 사항

- 아직 피드백을 받지 못했다.

## 요구사항

- 로그인 기능

- 로그인 상태에 따른 메뉴 처리

- 로그아웃

- 개인 정보 수정 (사용자 본인의 정보만을 수정 가능 하도록)

- 질문글 수정

- 질문글 삭제

  

## 로그인 기능

### 해결한 것

[✓]  로그인이 가능하다.

[✓]  로그인시에 세션 정보가 잘 저장 된다.

[✓]  현재 상태가 로그인 상태이면 상단 메뉴가 “로그아웃”, “개인정보수정”이 나타나야 하며, 로그아웃 상태이면 상단 메뉴가 “로그인”, “회원가입”이 나타난다.

### 미해결점 및 의문점

- handlebars의 {{#unless}} 로 if-else 분기를 시도 했으나 이 경우 session 객체에서 값을 꺼내오지 못함. 
  어쩔 수 없이 {{^session}} {{#session}} 다시 사용

  

## 개인정보 수정 기능

### 해결한 것

[✓]  로그인한 사용자 본인만 해당 개인정보를 수정 가능하다.

[✓]  비밀번호가 일치할 경우에만 수정 된다.

### 미해결점 및 의문점

- 비밀번호 수정 기능 미구현 (못구현)



## 게시글 작성 기능

### 해결한 것

[✓]  로그인한 사용자만 게시글 작성이 가능하다.

[✓]  폼의 글쓴이 필드에 자동으로 로그인한 사용자 이름이 자동 입력 된다.



## 게시글 수정 기능

### 해결한 것

[✓]  폼의 글쓴이 필드에 로그인한 사용자 이름과 제목, 글의 내용이 자동으로 입력 된다.

[✓]  로그인한 사용자가 아니거나 자신의 글이 아닌 사용자가 수정을 시도할 경우 로그인 화면으로 리다이렉트

[✓]  컨트롤러에서 PutMapping 으로 구현

### 미해결점 및 의문점

- 로그인한 사용자가 아니거나 본인의 게시글이 아닌 경우 에러 페이지 출력 기능
- 수정하는 과정이 무언가 매끄럽지 않다. 폼에 입력된 게시글 수정 정보를 그대로 가져와서 questionRepository에 저장하면 게시글이 새로 생성된다. id값 까지 가져와서 저장하는데도 기존 데이터가 갱신 되는 것이 아니라 아예 새로운 데이터가 생성이 되는 듯 하다.  어쩔 수 없이 id 값으로 해당 question 객체를 찾아와서 메소드를 호출하여 수정 내용을 객체에 반영한 뒤 DB에서 갱신을 하도록 했다. 더 좋은 방법이 있을듯 하다.



## 게시글 삭제 기능

### 해결한 것

[✓]  로그인한 사용자가 아니거나 자신의 글이 아닌 사용자가 삭제를 시도할 경우 로그인 화면으로 리다이렉트

[✓]  컨트롤러에서 DeleteMapping 으로 구현



# STEP 04.

## 피드백 반영 사항

[✓]  테이블 컬럼명은 스네이크 케이스를 사용하는 것이 관습인 듯 하여 고쳐 봤으나 컬럼 이름은 꼭 필요한게 아니라면 수정하지 말고 사용하기

[✓]  createdDate → createdDateTime : LocalDate가 존재 하기에 구분하기 위함

[✓]  맹목적인 getter, setter 지양하기

[✓]  특정 컨트롤러에 종속되는 메서드명은 목적어 생략하고 동사의 현재 시제로 표현하기    

​		ex. QuestionController#writeQuestion() → write()

[✓]  Optional을 이용한 null 체크

[🔺]  중복 코드 리팩토링

[🔺]  Logger 적용하기



## 요구사항

- User와 Question 엔터티 매핑
- Question과 Answer 엔터티를 OneToMany로 연결하여 답변 추가하기
- 답변 삭제하기



## User와 Question 연결

### 해결한 것

[✓] Question과 User가 ManyToOne 관계로 매핑 되어 있다.

[✓] User 클래스의 equals 메서드를 오버라이딩 하여 글쓴이와 session의 사용자 데이터가 일치하는지 식별할 수 있다.

[✓] 해당 사용자만 질문글을 삭제 또는 수정할 수 있다.



## 답변 추가하기

### 해결한 것

[✓] 사용자는 질문 상세보기 화면에서 답변 목록을 볼 수 있다.

[✓] 해당 질문글과 관련 있는 답변들만 질문글에 출력 된다.

[✓] 로그인한 사용자는 답변을 추가할 수 있다. 로그인을 하지 않을 경우 불가능



## 답변 삭제하기

### 해결한 것

[✓] 해당 사용자만 답변을 삭제 할 수 있다.



## 미해결점 및 의문점

- Question 엔터티와 OneToMany 관계인 답변의 개수를 List<>.size() 로 출력 하였다. 결과 값이 int인 것을 Long 타입으로 반환 될 수 있도록 형변환을 하였는데, 이렇게 하는게 맞는 걸까?

- 기존 예외상황 발생시 무조건 로그인 화면으로 리다이렉트 하던 방식에서 사용자 정의 예외처리 방식으로 수정을 하였다. 예외 클래스에 상태 코드를 저장하고 싶은데, 멤버 변수로 상태를 저장하기 보다는 enum이나 상태 정보를 담당하는 클래스를 따로 선언하는 방법도 좋을 듯 하다. 일단 구현은 다음 단계로 넘기고 사례를 찾아 봐야겠다.

- 결국 예외처리 핸들러를 추가 하였지만, 대부분 예전과 다름 없이 회원 가입이나 로그인을 의도하거나 홈으로 이동하도록 유도하는 뷰를 출력 하였다. 이렇게 하는게 맞는걸까?

- GlobalExceptionHandler 클래스에 @ControllerAdvice를 사용해서 ExceptionHandler가 컨트롤러 전역으로 적용 되도록 설정 하였다. 단순히 커스텀 에러 메시지를 뷰에 출력하는 간단한 로직이라 반환 하는 템플릿을 제외하고는 코드가 모두 똑같다. (Exception e)를 매개변수로 설정하는 방법 등 다형성으로 중복을 줄일 수는 없을까? 개선 할 방법을 고민 해봐야겠다.

- Optional을 사용하다 보니 null이 될 수도 있는 메서드 반환 값에 다른 타입으로 형변환이 되는 코드가 들어갔다. 그런데 컴파일 에러가 나지 않는다. null 값이 형변환 되는 코드를 굳이 고치지 않아도 괜찮을까?

- 세션에 사용자 데이터가 존재하지 않는다. <===> 로그인을 하지 않았다 (???)

- Question selectedQuestion = questionRepository.findById(id).orElseThrow(QuestionNotFoundException::new); ⇒ 리팩토링 실패. 더 고민 해봐야 겠다.















